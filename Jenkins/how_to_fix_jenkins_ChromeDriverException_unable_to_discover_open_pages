#
# how to check ut_coverage_all failed with ChromeDriver Exception "unable to discover open pages"
#	in a Jenkins job using com.github.tntim96:jscover-server-maven-plugin:1.0.14:jscover
#
  http://shg-cvom-infra.pgdev.sap.corp:8080/job/ut_jscover_all/688/consoleFull

	
	[ERROR] Failed to execute goal com.github.tntim96:jscover-server-maven-plugin:1.0.14:jscover (default-cli) on project sap.viz.controls: Execution default-cli of goal com.github.tntim96:jscover-server-maven-plugin:1.0.14:jscover failed: java.lang.reflect.InvocationTargetException: unknown error: unable to discover open pages
	[ERROR] (Driver info: chromedriver=2.19.346078 (6f1f0cde889532d48ce8242342d0b84f94b114a1),platform=Windows NT 6.1 SP1 x86_64) (WARNING: The server did not provide any stacktrace information)
	[ERROR] Command duration or timeout: 61.23 seconds
	[ERROR] Build info: version: '2.46.0', revision: '61506a4624b13675f24581e453592342b7485d71', time: '2015-06-04 10:22:50'
	[ERROR] System info: host: 'SHGCVOMCOVER01', ip: '10.193.229.200', os.name: 'Windows Server 2008 R2', os.arch: 'amd64', os.version: '6.1', java.version: '1.8.0_45'
	[ERROR] Driver info: org.openqa.selenium.chrome.ChromeDriver
	[ERROR] -> [Help 1]


Root cause 1:
1) plugin pre-requisite: Jenkins slave service must be log on as admin, instead of Local System account.

Same issue met by others.
	
	Comment 22 by nka...@logitech.com, Sep 9, 2015
	
	I have same issues with Browser launch but url does not load, 
	Same test program was able to run, suddenly it stopped working so i have update JDK 1.8 and jre 1.8.0._60  chromedriver 2.19.346078. still have the same issues.  
	
	manually copied url into webdriver browser it starts executing the test cases.
	Looks like initial loading for URL is the problem. 
	
	##  ref doc: https://bugs.chromium.org/p/chromedriver/issues/detail?id=598 

Debug steps:
	1) local build on PVGD50896080A.apj.global.corp.sap: build pass
	
	mvn clean package -P !jshint
	mvn -gs C:\Work\tools\Maven\maven-settings-on-jenkins\Jenkins_GlobalSettings_global_maven_settings.xml -s C:\Work\tools\Maven\maven-settings-on-jenkins\LeanDI_settings_maven_user_settings.xml -f container/pom.xml jscover-server:jscover -Punit_test
	
	2) local build on shgcvomcover01.dhcp.pgdev.sap.corp: build pass
	3) re-download plugin C:\.m2\repository\org\chromium\download\chrome\test\chromedriver\2.19\chromedriver-2.19-win32.zip: jenkins job failed.
	4) switch to run the job on PVGD50832166A.apj.global.corp.sap : jenkins job failed.
	
	
	[works]		5) switch jenkins service on shgcvomcover01.dhcp.pgdev.sap.corp from Local System account to global\service.tip.cvom: jenkins job succeeded.
	
						I have found the solution for this issue. it is working fine for me.
						If you are using windows, run your Jenkins services in system admin,
						1. open to run cmd
						2. Enter service and click Okay button
						3. A service dialog box open, locate Jenkins services. Go to properties of service
						4. Go to logon tab, choose the second option. provide the your admin user not the local server
						5. then restart the services.
						This will work
	
					# ref doc: https://groups.google.com/forum/?hl=en#!topic/selenium-users/gfvfH-YEC48
					# ref doc: https://bugs.chromium.org/p/chromedriver/issues/detail?id=679
		
		
	[NOT work in a Jenkins job]	6) add option '--no-sandbox' to chromedriver	
	[NOT work in a Jenkins job]			on a Jenkins slave, set "C:\Program Files (x86)\Google\Chrome\Application\chrome.exe" --no-sandbox
	[NOT work in a Jenkins job]			delete all files in C:\Users\SERVICE.TIP.CVOM\AppData\Local\Google\Chrome\User Data\Default\Local Storage\
	[NOT work in a Jenkins job]	In my case, adding the --no-sandbox argument to ChromeOptions solved the problem.
	[NOT work in a Jenkins job]	
	[NOT work in a Jenkins job]	
	[NOT work in a Jenkins job]	For avoiding this problem we add this option for driver.
	[NOT work in a Jenkins job]	
	[NOT work in a Jenkins job]	ChromeOptions options = new ChromeOptions();
	[NOT work in a Jenkins job]	               options.addArguments("no-sandbox");
	[NOT work in a Jenkins job]				   
	[NOT work in a Jenkins job]	Adding
	[NOT work in a Jenkins job]	  capabilities: {
	[NOT work in a Jenkins job]	    browserName: 'chrome',
	[NOT work in a Jenkins job]	    chromeOptions: {
	[NOT work in a Jenkins job]	      args: ['--no-sandbox']
	[NOT work in a Jenkins job]	    },
	[NOT work in a Jenkins job]	
	[NOT work in a Jenkins job]	to my Protractor configuration file solved the problem.
	[NOT work in a Jenkins job]	
	[NOT work in a Jenkins job]	7)  to set 'Turn off display after' in Windows' Power Options to 'Never'
	[NOT work in a Jenkins job]		I had the same problem, but updating to the latest ChromeDriver (v2.8) did not solve it for me. 
	[NOT work in a Jenkins job]		I was running Selenium on a CI server (A Dell machine running 64 bit Win 7). 
	[NOT work in a Jenkins job]		I got the exception every time when the server had been 'idle' for a while.
	[NOT work in a Jenkins job]	
	[NOT work in a Jenkins job]	What fixed the problem for me was to set 'Turn off display after' in Windows' Power Options to 'Never'.
	[NOT work in a Jenkins job]		# ref doc: http://stackoverflow.com/questions/21001652/chrome-driver-error-using-selenium-unable-to-discover-open-pages
	[NOT work in a Jenkins job]			
	[NOT work in a Jenkins job]	8) for Jenkins master:
	[NOT work in a Jenkins job]		in jenkins.xml:
	[NOT work in a Jenkins job]		<executable>java</executable>
	[NOT work in a Jenkins job]		<arguments>-Xrs -XX:MaxMetaspaceSize=1024m -Xms512m -Xmx4096m -Dhudson.lifecycle=hudson.lifecycle.WindowsServiceLifecycle -jar "%BASE%\jenkins.war" --httpPort=8080</arguments>
	[NOT work in a Jenkins job]	
	[NOT work in a Jenkins job]	for Jenkins slave:
	[NOT work in a Jenkins job]			<executable>C:\Program Files\Java\jdk1.8.0_45\bin\java.exe</executable>
	[NOT work in a Jenkins job]			<arguments>-Xrs  -jar "%BASE%\slave.jar" -jnlpUrl http://shg-cvom-infra.pgdev.sap.corp:8080/computer/PVGD50930642A-Z840/slave-agent.jnlp -secret c9cf191b19ba3cb9876ae320e86c4f22f78e538a3714520706f7618fc87ad5a8</arguments>
	[NOT work in a Jenkins job]			-XX:MaxMetaspaceSize=512m -Xms512m -Xmx1024m
	[NOT work in a Jenkins job]			
	[NOT work in a Jenkins job]	9)	chromedriver from 19 -> 21
	[NOT work in a Jenkins job]		org.chromium.download.chrome.test:chromedriver:2.21
	[NOT work in a Jenkins job]		
	[NOT work in a Jenkins job]		chrome browser: Version 52.0.2743.116 m
	[NOT work in a Jenkins job]		OS:				Windows Server 2008 R2
	[NOT work in a Jenkins job]		
	[NOT work in a Jenkins job]		Java version: 1.8.0_45, vendor: Oracle Corporation
	[NOT work in a Jenkins job]		Java home: c:\jenkins\tools\hudson.model.JDK\JDK-8u45\jre
	[NOT work in a Jenkins job]		Default locale: en_US, platform encoding: Cp1252
	[NOT work in a Jenkins job]		OS name: "windows server 2008 r2", version: "6.1", arch: "amd64", family: "dos"
		

Root cause 2:
	Jenkins Slave service needs to be started in CMI instead of a service for jscover-server-maven-plugin.
	
	Steps:
		rdp to shgcvomcover01 
		pushd C:\jenkins_infra\ 
		"C:\Program Files\Java\jdk1.8.0_45\bin\java.exe" -Xrs -XX:MaxMetaspaceSize=512m -Xms512m -Xmx1024m -jar slave.jar -jnlpUrl http://shg-cvom-infra.pgdev.sap.corp:8080/computer/UT_coverage(shgcvomcover01)/slave-agent.jnlp -secret 1bf236495470b59d611ae0ff1e160a99b31ffef93662e3d9e153deeaf0680409

